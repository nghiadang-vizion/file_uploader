{"ast":null,"code":"// A reader for when we don't yet know what kind of thing\n// the thing is.\n\nmodule.exports = ProxyReader;\nvar Reader = require('./reader.js');\nvar getType = require('./get-type.js');\nvar inherits = require('inherits');\nvar fs = require('graceful-fs');\ninherits(ProxyReader, Reader);\nfunction ProxyReader(props) {\n  var self = this;\n  if (!(self instanceof ProxyReader)) {\n    throw new Error('ProxyReader must be called as constructor.');\n  }\n  self.props = props;\n  self._buffer = [];\n  self.ready = false;\n  Reader.call(self, props);\n}\nProxyReader.prototype._stat = function () {\n  var self = this;\n  var props = self.props;\n  // stat the thing to see what the proxy should be.\n  var stat = props.follow ? 'stat' : 'lstat';\n  fs[stat](props.path, function (er, current) {\n    var type;\n    if (er || !current) {\n      type = 'File';\n    } else {\n      type = getType(current);\n    }\n    props[type] = true;\n    props.type = self.type = type;\n    self._old = current;\n    self._addProxy(Reader(props, current));\n  });\n};\nProxyReader.prototype._addProxy = function (proxy) {\n  var self = this;\n  if (self._proxyTarget) {\n    return self.error('proxy already set');\n  }\n  self._proxyTarget = proxy;\n  proxy._proxy = self;\n  ['error', 'data', 'end', 'close', 'linkpath', 'entry', 'entryEnd', 'child', 'childEnd', 'warn', 'stat'].forEach(function (ev) {\n    // console.error('~~ proxy event', ev, self.path)\n    proxy.on(ev, self.emit.bind(self, ev));\n  });\n  self.emit('proxy', proxy);\n  proxy.on('ready', function () {\n    // console.error(\"~~ proxy is ready!\", self.path)\n    self.ready = true;\n    self.emit('ready');\n  });\n  var calls = self._buffer;\n  self._buffer.length = 0;\n  calls.forEach(function (c) {\n    proxy[c[0]].apply(proxy, c[1]);\n  });\n};\nProxyReader.prototype.pause = function () {\n  return this._proxyTarget ? this._proxyTarget.pause() : false;\n};\nProxyReader.prototype.resume = function () {\n  return this._proxyTarget ? this._proxyTarget.resume() : false;\n};","map":{"version":3,"names":["module","exports","ProxyReader","Reader","require","getType","inherits","fs","props","self","Error","_buffer","ready","call","prototype","_stat","stat","follow","path","er","current","type","_old","_addProxy","proxy","_proxyTarget","error","_proxy","forEach","ev","on","emit","bind","calls","length","c","apply","pause","resume"],"sources":["/Users/dangnghia/Documents/vizion/file-uploader/client/node_modules/fstream/lib/proxy-reader.js"],"sourcesContent":["// A reader for when we don't yet know what kind of thing\n// the thing is.\n\nmodule.exports = ProxyReader\n\nvar Reader = require('./reader.js')\nvar getType = require('./get-type.js')\nvar inherits = require('inherits')\nvar fs = require('graceful-fs')\n\ninherits(ProxyReader, Reader)\n\nfunction ProxyReader (props) {\n  var self = this\n  if (!(self instanceof ProxyReader)) {\n    throw new Error('ProxyReader must be called as constructor.')\n  }\n\n  self.props = props\n  self._buffer = []\n  self.ready = false\n\n  Reader.call(self, props)\n}\n\nProxyReader.prototype._stat = function () {\n  var self = this\n  var props = self.props\n  // stat the thing to see what the proxy should be.\n  var stat = props.follow ? 'stat' : 'lstat'\n\n  fs[stat](props.path, function (er, current) {\n    var type\n    if (er || !current) {\n      type = 'File'\n    } else {\n      type = getType(current)\n    }\n\n    props[type] = true\n    props.type = self.type = type\n\n    self._old = current\n    self._addProxy(Reader(props, current))\n  })\n}\n\nProxyReader.prototype._addProxy = function (proxy) {\n  var self = this\n  if (self._proxyTarget) {\n    return self.error('proxy already set')\n  }\n\n  self._proxyTarget = proxy\n  proxy._proxy = self\n\n  ;[\n    'error',\n    'data',\n    'end',\n    'close',\n    'linkpath',\n    'entry',\n    'entryEnd',\n    'child',\n    'childEnd',\n    'warn',\n    'stat'\n  ].forEach(function (ev) {\n    // console.error('~~ proxy event', ev, self.path)\n    proxy.on(ev, self.emit.bind(self, ev))\n  })\n\n  self.emit('proxy', proxy)\n\n  proxy.on('ready', function () {\n    // console.error(\"~~ proxy is ready!\", self.path)\n    self.ready = true\n    self.emit('ready')\n  })\n\n  var calls = self._buffer\n  self._buffer.length = 0\n  calls.forEach(function (c) {\n    proxy[c[0]].apply(proxy, c[1])\n  })\n}\n\nProxyReader.prototype.pause = function () {\n  return this._proxyTarget ? this._proxyTarget.pause() : false\n}\n\nProxyReader.prototype.resume = function () {\n  return this._proxyTarget ? this._proxyTarget.resume() : false\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}