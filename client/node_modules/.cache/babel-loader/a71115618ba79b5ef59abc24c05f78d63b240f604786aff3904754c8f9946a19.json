{"ast":null,"code":"module.exports = FileWriter;\nvar fs = require('graceful-fs');\nvar Writer = require('./writer.js');\nvar inherits = require('inherits');\nvar EOF = {};\ninherits(FileWriter, Writer);\nfunction FileWriter(props) {\n  var self = this;\n  if (!(self instanceof FileWriter)) {\n    throw new Error('FileWriter must be called as constructor.');\n  }\n\n  // should already be established as a File type\n  if (props.type !== 'File' || !props.File) {\n    throw new Error('Non-file type ' + props.type);\n  }\n  self._buffer = [];\n  self._bytesWritten = 0;\n  Writer.call(this, props);\n}\nFileWriter.prototype._create = function () {\n  var self = this;\n  if (self._stream) return;\n  var so = {};\n  if (self.props.flags) so.flags = self.props.flags;\n  so.mode = Writer.filemode;\n  if (self._old && self._old.blksize) so.bufferSize = self._old.blksize;\n  self._stream = fs.createWriteStream(self._path, so);\n  self._stream.on('open', function () {\n    // console.error(\"FW open\", self._buffer, self._path)\n    self.ready = true;\n    self._buffer.forEach(function (c) {\n      if (c === EOF) self._stream.end();else self._stream.write(c);\n    });\n    self.emit('ready');\n    // give this a kick just in case it needs it.\n    self.emit('drain');\n  });\n  self._stream.on('error', function (er) {\n    self.emit('error', er);\n  });\n  self._stream.on('drain', function () {\n    self.emit('drain');\n  });\n  self._stream.on('close', function () {\n    // console.error('\\n\\nFW Stream Close', self._path, self.size)\n    self._finish();\n  });\n};\nFileWriter.prototype.write = function (c) {\n  var self = this;\n  self._bytesWritten += c.length;\n  if (!self.ready) {\n    if (!Buffer.isBuffer(c) && typeof c !== 'string') {\n      throw new Error('invalid write data');\n    }\n    self._buffer.push(c);\n    return false;\n  }\n  var ret = self._stream.write(c);\n  // console.error('\\t-- fw wrote, _stream says', ret, self._stream._queue.length)\n\n  // allow 2 buffered writes, because otherwise there's just too\n  // much stop and go bs.\n  if (ret === false && self._stream._queue) {\n    return self._stream._queue.length <= 2;\n  } else {\n    return ret;\n  }\n};\nFileWriter.prototype.end = function (c) {\n  var self = this;\n  if (c) self.write(c);\n  if (!self.ready) {\n    self._buffer.push(EOF);\n    return false;\n  }\n  return self._stream.end();\n};\nFileWriter.prototype._finish = function () {\n  var self = this;\n  if (typeof self.size === 'number' && self._bytesWritten !== self.size) {\n    self.error('Did not get expected byte count.\\n' + 'expect: ' + self.size + '\\n' + 'actual: ' + self._bytesWritten);\n  }\n  Writer.prototype._finish.call(self);\n};","map":{"version":3,"names":["module","exports","FileWriter","fs","require","Writer","inherits","EOF","props","self","Error","type","File","_buffer","_bytesWritten","call","prototype","_create","_stream","so","flags","mode","filemode","_old","blksize","bufferSize","createWriteStream","_path","on","ready","forEach","c","end","write","emit","er","_finish","length","Buffer","isBuffer","push","ret","_queue","size","error"],"sources":["/Users/dangnghia/Documents/vizion/file-uploader/client/node_modules/fstream/lib/file-writer.js"],"sourcesContent":["module.exports = FileWriter\n\nvar fs = require('graceful-fs')\nvar Writer = require('./writer.js')\nvar inherits = require('inherits')\nvar EOF = {}\n\ninherits(FileWriter, Writer)\n\nfunction FileWriter (props) {\n  var self = this\n  if (!(self instanceof FileWriter)) {\n    throw new Error('FileWriter must be called as constructor.')\n  }\n\n  // should already be established as a File type\n  if (props.type !== 'File' || !props.File) {\n    throw new Error('Non-file type ' + props.type)\n  }\n\n  self._buffer = []\n  self._bytesWritten = 0\n\n  Writer.call(this, props)\n}\n\nFileWriter.prototype._create = function () {\n  var self = this\n  if (self._stream) return\n\n  var so = {}\n  if (self.props.flags) so.flags = self.props.flags\n  so.mode = Writer.filemode\n  if (self._old && self._old.blksize) so.bufferSize = self._old.blksize\n\n  self._stream = fs.createWriteStream(self._path, so)\n\n  self._stream.on('open', function () {\n    // console.error(\"FW open\", self._buffer, self._path)\n    self.ready = true\n    self._buffer.forEach(function (c) {\n      if (c === EOF) self._stream.end()\n      else self._stream.write(c)\n    })\n    self.emit('ready')\n    // give this a kick just in case it needs it.\n    self.emit('drain')\n  })\n\n  self._stream.on('error', function (er) { self.emit('error', er) })\n\n  self._stream.on('drain', function () { self.emit('drain') })\n\n  self._stream.on('close', function () {\n    // console.error('\\n\\nFW Stream Close', self._path, self.size)\n    self._finish()\n  })\n}\n\nFileWriter.prototype.write = function (c) {\n  var self = this\n\n  self._bytesWritten += c.length\n\n  if (!self.ready) {\n    if (!Buffer.isBuffer(c) && typeof c !== 'string') {\n      throw new Error('invalid write data')\n    }\n    self._buffer.push(c)\n    return false\n  }\n\n  var ret = self._stream.write(c)\n  // console.error('\\t-- fw wrote, _stream says', ret, self._stream._queue.length)\n\n  // allow 2 buffered writes, because otherwise there's just too\n  // much stop and go bs.\n  if (ret === false && self._stream._queue) {\n    return self._stream._queue.length <= 2\n  } else {\n    return ret\n  }\n}\n\nFileWriter.prototype.end = function (c) {\n  var self = this\n\n  if (c) self.write(c)\n\n  if (!self.ready) {\n    self._buffer.push(EOF)\n    return false\n  }\n\n  return self._stream.end()\n}\n\nFileWriter.prototype._finish = function () {\n  var self = this\n  if (typeof self.size === 'number' && self._bytesWritten !== self.size) {\n    self.error(\n      'Did not get expected byte count.\\n' +\n      'expect: ' + self.size + '\\n' +\n      'actual: ' + self._bytesWritten)\n  }\n  Writer.prototype._finish.call(self)\n}\n"],"mappings":"AAAAA,MAAM,CAACC,OAAO,GAAGC,UAAU;AAE3B,IAAIC,EAAE,GAAGC,OAAO,CAAC,aAAa,CAAC;AAC/B,IAAIC,MAAM,GAAGD,OAAO,CAAC,aAAa,CAAC;AACnC,IAAIE,QAAQ,GAAGF,OAAO,CAAC,UAAU,CAAC;AAClC,IAAIG,GAAG,GAAG,CAAC,CAAC;AAEZD,QAAQ,CAACJ,UAAU,EAAEG,MAAM,CAAC;AAE5B,SAASH,UAAUA,CAAEM,KAAK,EAAE;EAC1B,IAAIC,IAAI,GAAG,IAAI;EACf,IAAI,EAAEA,IAAI,YAAYP,UAAU,CAAC,EAAE;IACjC,MAAM,IAAIQ,KAAK,CAAC,2CAA2C,CAAC;EAC9D;;EAEA;EACA,IAAIF,KAAK,CAACG,IAAI,KAAK,MAAM,IAAI,CAACH,KAAK,CAACI,IAAI,EAAE;IACxC,MAAM,IAAIF,KAAK,CAAC,gBAAgB,GAAGF,KAAK,CAACG,IAAI,CAAC;EAChD;EAEAF,IAAI,CAACI,OAAO,GAAG,EAAE;EACjBJ,IAAI,CAACK,aAAa,GAAG,CAAC;EAEtBT,MAAM,CAACU,IAAI,CAAC,IAAI,EAAEP,KAAK,CAAC;AAC1B;AAEAN,UAAU,CAACc,SAAS,CAACC,OAAO,GAAG,YAAY;EACzC,IAAIR,IAAI,GAAG,IAAI;EACf,IAAIA,IAAI,CAACS,OAAO,EAAE;EAElB,IAAIC,EAAE,GAAG,CAAC,CAAC;EACX,IAAIV,IAAI,CAACD,KAAK,CAACY,KAAK,EAAED,EAAE,CAACC,KAAK,GAAGX,IAAI,CAACD,KAAK,CAACY,KAAK;EACjDD,EAAE,CAACE,IAAI,GAAGhB,MAAM,CAACiB,QAAQ;EACzB,IAAIb,IAAI,CAACc,IAAI,IAAId,IAAI,CAACc,IAAI,CAACC,OAAO,EAAEL,EAAE,CAACM,UAAU,GAAGhB,IAAI,CAACc,IAAI,CAACC,OAAO;EAErEf,IAAI,CAACS,OAAO,GAAGf,EAAE,CAACuB,iBAAiB,CAACjB,IAAI,CAACkB,KAAK,EAAER,EAAE,CAAC;EAEnDV,IAAI,CAACS,OAAO,CAACU,EAAE,CAAC,MAAM,EAAE,YAAY;IAClC;IACAnB,IAAI,CAACoB,KAAK,GAAG,IAAI;IACjBpB,IAAI,CAACI,OAAO,CAACiB,OAAO,CAAC,UAAUC,CAAC,EAAE;MAChC,IAAIA,CAAC,KAAKxB,GAAG,EAAEE,IAAI,CAACS,OAAO,CAACc,GAAG,CAAC,CAAC,MAC5BvB,IAAI,CAACS,OAAO,CAACe,KAAK,CAACF,CAAC,CAAC;IAC5B,CAAC,CAAC;IACFtB,IAAI,CAACyB,IAAI,CAAC,OAAO,CAAC;IAClB;IACAzB,IAAI,CAACyB,IAAI,CAAC,OAAO,CAAC;EACpB,CAAC,CAAC;EAEFzB,IAAI,CAACS,OAAO,CAACU,EAAE,CAAC,OAAO,EAAE,UAAUO,EAAE,EAAE;IAAE1B,IAAI,CAACyB,IAAI,CAAC,OAAO,EAAEC,EAAE,CAAC;EAAC,CAAC,CAAC;EAElE1B,IAAI,CAACS,OAAO,CAACU,EAAE,CAAC,OAAO,EAAE,YAAY;IAAEnB,IAAI,CAACyB,IAAI,CAAC,OAAO,CAAC;EAAC,CAAC,CAAC;EAE5DzB,IAAI,CAACS,OAAO,CAACU,EAAE,CAAC,OAAO,EAAE,YAAY;IACnC;IACAnB,IAAI,CAAC2B,OAAO,CAAC,CAAC;EAChB,CAAC,CAAC;AACJ,CAAC;AAEDlC,UAAU,CAACc,SAAS,CAACiB,KAAK,GAAG,UAAUF,CAAC,EAAE;EACxC,IAAItB,IAAI,GAAG,IAAI;EAEfA,IAAI,CAACK,aAAa,IAAIiB,CAAC,CAACM,MAAM;EAE9B,IAAI,CAAC5B,IAAI,CAACoB,KAAK,EAAE;IACf,IAAI,CAACS,MAAM,CAACC,QAAQ,CAACR,CAAC,CAAC,IAAI,OAAOA,CAAC,KAAK,QAAQ,EAAE;MAChD,MAAM,IAAIrB,KAAK,CAAC,oBAAoB,CAAC;IACvC;IACAD,IAAI,CAACI,OAAO,CAAC2B,IAAI,CAACT,CAAC,CAAC;IACpB,OAAO,KAAK;EACd;EAEA,IAAIU,GAAG,GAAGhC,IAAI,CAACS,OAAO,CAACe,KAAK,CAACF,CAAC,CAAC;EAC/B;;EAEA;EACA;EACA,IAAIU,GAAG,KAAK,KAAK,IAAIhC,IAAI,CAACS,OAAO,CAACwB,MAAM,EAAE;IACxC,OAAOjC,IAAI,CAACS,OAAO,CAACwB,MAAM,CAACL,MAAM,IAAI,CAAC;EACxC,CAAC,MAAM;IACL,OAAOI,GAAG;EACZ;AACF,CAAC;AAEDvC,UAAU,CAACc,SAAS,CAACgB,GAAG,GAAG,UAAUD,CAAC,EAAE;EACtC,IAAItB,IAAI,GAAG,IAAI;EAEf,IAAIsB,CAAC,EAAEtB,IAAI,CAACwB,KAAK,CAACF,CAAC,CAAC;EAEpB,IAAI,CAACtB,IAAI,CAACoB,KAAK,EAAE;IACfpB,IAAI,CAACI,OAAO,CAAC2B,IAAI,CAACjC,GAAG,CAAC;IACtB,OAAO,KAAK;EACd;EAEA,OAAOE,IAAI,CAACS,OAAO,CAACc,GAAG,CAAC,CAAC;AAC3B,CAAC;AAED9B,UAAU,CAACc,SAAS,CAACoB,OAAO,GAAG,YAAY;EACzC,IAAI3B,IAAI,GAAG,IAAI;EACf,IAAI,OAAOA,IAAI,CAACkC,IAAI,KAAK,QAAQ,IAAIlC,IAAI,CAACK,aAAa,KAAKL,IAAI,CAACkC,IAAI,EAAE;IACrElC,IAAI,CAACmC,KAAK,CACR,oCAAoC,GACpC,UAAU,GAAGnC,IAAI,CAACkC,IAAI,GAAG,IAAI,GAC7B,UAAU,GAAGlC,IAAI,CAACK,aAAa,CAAC;EACpC;EACAT,MAAM,CAACW,SAAS,CAACoB,OAAO,CAACrB,IAAI,CAACN,IAAI,CAAC;AACrC,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}