{"ast":null,"code":"// A writer for when we don't know what kind of thing\n// the thing is.  That is, it's not explicitly set,\n// so we're going to make it whatever the thing already\n// is, or \"File\"\n//\n// Until then, collect all events.\n\nmodule.exports = ProxyWriter;\nvar Writer = require('./writer.js');\nvar getType = require('./get-type.js');\nvar inherits = require('inherits');\nvar collect = require('./collect.js');\nvar fs = require('fs');\ninherits(ProxyWriter, Writer);\nfunction ProxyWriter(props) {\n  var self = this;\n  if (!(self instanceof ProxyWriter)) {\n    throw new Error('ProxyWriter must be called as constructor.');\n  }\n  self.props = props;\n  self._needDrain = false;\n  Writer.call(self, props);\n}\nProxyWriter.prototype._stat = function () {\n  var self = this;\n  var props = self.props;\n  // stat the thing to see what the proxy should be.\n  var stat = props.follow ? 'stat' : 'lstat';\n  fs[stat](props.path, function (er, current) {\n    var type;\n    if (er || !current) {\n      type = 'File';\n    } else {\n      type = getType(current);\n    }\n    props[type] = true;\n    props.type = self.type = type;\n    self._old = current;\n    self._addProxy(Writer(props, current));\n  });\n};\nProxyWriter.prototype._addProxy = function (proxy) {\n  // console.error(\"~~ set proxy\", this.path)\n  var self = this;\n  if (self._proxy) {\n    return self.error('proxy already set');\n  }\n  self._proxy = proxy;\n  ['ready', 'error', 'close', 'pipe', 'drain', 'warn'].forEach(function (ev) {\n    proxy.on(ev, self.emit.bind(self, ev));\n  });\n  self.emit('proxy', proxy);\n  var calls = self._buffer;\n  calls.forEach(function (c) {\n    // console.error(\"~~ ~~ proxy buffered call\", c[0], c[1])\n    proxy[c[0]].apply(proxy, c[1]);\n  });\n  self._buffer.length = 0;\n  if (self._needsDrain) self.emit('drain');\n};\nProxyWriter.prototype.add = function (entry) {\n  // console.error(\"~~ proxy add\")\n  collect(entry);\n  if (!this._proxy) {\n    this._buffer.push(['add', [entry]]);\n    this._needDrain = true;\n    return false;\n  }\n  return this._proxy.add(entry);\n};\nProxyWriter.prototype.write = function (c) {\n  // console.error('~~ proxy write')\n  if (!this._proxy) {\n    this._buffer.push(['write', [c]]);\n    this._needDrain = true;\n    return false;\n  }\n  return this._proxy.write(c);\n};\nProxyWriter.prototype.end = function (c) {\n  // console.error('~~ proxy end')\n  if (!this._proxy) {\n    this._buffer.push(['end', [c]]);\n    return false;\n  }\n  return this._proxy.end(c);\n};","map":{"version":3,"names":["module","exports","ProxyWriter","Writer","require","getType","inherits","collect","fs","props","self","Error","_needDrain","call","prototype","_stat","stat","follow","path","er","current","type","_old","_addProxy","proxy","_proxy","error","forEach","ev","on","emit","bind","calls","_buffer","c","apply","length","_needsDrain","add","entry","push","write","end"],"sources":["/Users/dangnghia/Documents/vizion/file-uploader/client/node_modules/fstream/lib/proxy-writer.js"],"sourcesContent":["// A writer for when we don't know what kind of thing\n// the thing is.  That is, it's not explicitly set,\n// so we're going to make it whatever the thing already\n// is, or \"File\"\n//\n// Until then, collect all events.\n\nmodule.exports = ProxyWriter\n\nvar Writer = require('./writer.js')\nvar getType = require('./get-type.js')\nvar inherits = require('inherits')\nvar collect = require('./collect.js')\nvar fs = require('fs')\n\ninherits(ProxyWriter, Writer)\n\nfunction ProxyWriter (props) {\n  var self = this\n  if (!(self instanceof ProxyWriter)) {\n    throw new Error('ProxyWriter must be called as constructor.')\n  }\n\n  self.props = props\n  self._needDrain = false\n\n  Writer.call(self, props)\n}\n\nProxyWriter.prototype._stat = function () {\n  var self = this\n  var props = self.props\n  // stat the thing to see what the proxy should be.\n  var stat = props.follow ? 'stat' : 'lstat'\n\n  fs[stat](props.path, function (er, current) {\n    var type\n    if (er || !current) {\n      type = 'File'\n    } else {\n      type = getType(current)\n    }\n\n    props[type] = true\n    props.type = self.type = type\n\n    self._old = current\n    self._addProxy(Writer(props, current))\n  })\n}\n\nProxyWriter.prototype._addProxy = function (proxy) {\n  // console.error(\"~~ set proxy\", this.path)\n  var self = this\n  if (self._proxy) {\n    return self.error('proxy already set')\n  }\n\n  self._proxy = proxy\n  ;[\n    'ready',\n    'error',\n    'close',\n    'pipe',\n    'drain',\n    'warn'\n  ].forEach(function (ev) {\n    proxy.on(ev, self.emit.bind(self, ev))\n  })\n\n  self.emit('proxy', proxy)\n\n  var calls = self._buffer\n  calls.forEach(function (c) {\n    // console.error(\"~~ ~~ proxy buffered call\", c[0], c[1])\n    proxy[c[0]].apply(proxy, c[1])\n  })\n  self._buffer.length = 0\n  if (self._needsDrain) self.emit('drain')\n}\n\nProxyWriter.prototype.add = function (entry) {\n  // console.error(\"~~ proxy add\")\n  collect(entry)\n\n  if (!this._proxy) {\n    this._buffer.push(['add', [entry]])\n    this._needDrain = true\n    return false\n  }\n  return this._proxy.add(entry)\n}\n\nProxyWriter.prototype.write = function (c) {\n  // console.error('~~ proxy write')\n  if (!this._proxy) {\n    this._buffer.push(['write', [c]])\n    this._needDrain = true\n    return false\n  }\n  return this._proxy.write(c)\n}\n\nProxyWriter.prototype.end = function (c) {\n  // console.error('~~ proxy end')\n  if (!this._proxy) {\n    this._buffer.push(['end', [c]])\n    return false\n  }\n  return this._proxy.end(c)\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}